<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý sản phẩm</title>
  <link rel="stylesheet" href="/styles.css">
  <script defer src="/app.js"></script>
  <script>
    // Kiểm tra đăng nhập trước khi load trang
    async function checkAuth() {
      try {
        const response = await fetch('/api/auth/check', {
          credentials: 'include'
        });
        const data = await response.json();
        
        if (!data.authenticated) {
          window.location.href = '/login.html';
          return;
        }
        
        // Nếu đã đăng nhập, load sản phẩm
        if (typeof loadProducts === 'function') {
          loadProducts();
        }
      } catch (error) {
        console.error('Auth check failed:', error);
        window.location.href = '/login.html';
      }
    }
    
    document.addEventListener('DOMContentLoaded', checkAuth);
    
    async function logout() {
      try {
        await fetch('/api/auth/logout', {
          method: 'POST',
          credentials: 'include'
        });
        window.location.href = '/login.html';
      } catch (error) {
        console.error('Logout failed:', error);
        window.location.href = '/login.html';
      }
    }
  </script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Sản phẩm</h1>
      <nav>
        <a href="/index.html">Trang chủ</a>
        <a href="/customers.html">Khách hàng</a>
        <a href="/orders.html">Đơn hàng</a>
        <a href="/stats.html">Thống kê</a>
        <button onclick="logout()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-left: 10px;">Đăng xuất</button>
      </nav>
    </header>

    <div class="card">
      <h3>Thêm sản phẩm mới</h3>
      <form id="createForm">
        <input name="name" placeholder="Tên sản phẩm" required>
        <input name="price" placeholder="Giá" required type="number" step="0.01">
        <input name="stock" placeholder="Tồn" required type="number" step="1">
        <button class="btn" type="submit">Thêm</button>
      </form>

      <hr style="margin: 20px 0;">

      <h3>Import từ Excel</h3>
      <form id="importForm" enctype="multipart/form-data">
        <div style="margin-bottom: 10px;">
          <input type="file" id="excelFile" name="excelFile" accept=".xlsx,.xls" required>
          <label for="excelFile" style="margin-left: 10px; font-size: 14px; color: #666;">
            Chọn file Excel (.xlsx, .xls)
          </label>
        </div>
        <div style="margin-bottom: 15px;">
          <small style="color: #666;">
            Định dạng file Excel: Cột A = "Tên sản phẩm", Cột B = "Giá (VNĐ)" hoặc "Giá", Cột C = "Tồn kho"
          </small>
        </div>
        <button class="btn" type="submit" style="background-color: #28a745;">Import Excel</button>
      </form>
      <div id="importResult" style="margin-top: 15px;"></div>

      <hr style="margin: 30px 0;">

      <h3>Tìm kiếm và lọc sản phẩm</h3>
      <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 200px;">
          <input type="text" id="searchInput" placeholder="Tìm kiếm theo tên sản phẩm..." style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div style="flex: 1; min-width: 150px;">
          <select id="stockFilter" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="">Tất cả tồn kho</option>
            <option value="0">Hết hàng (0)</option>
            <option value="1-10">Ít hàng (1-10)</option>
            <option value="11-50">Trung bình (11-50)</option>
            <option value="51+">Nhiều hàng (51+)</option>
          </select>
        </div>
        <div style="flex: 1; min-width: 120px;">
          <select id="sortBy" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="id-desc">Mới nhất</option>
            <option value="id-asc">Cũ nhất</option>
            <option value="name-asc">Tên A-Z</option>
            <option value="name-desc">Tên Z-A</option>
            <option value="price-asc">Giá thấp → cao</option>
            <option value="price-desc">Giá cao → thấp</option>
            <option value="stock-asc">Tồn ít → nhiều</option>
            <option value="stock-desc">Tồn nhiều → ít</option>
          </select>
        </div>
        <div>
          <button id="clearFilters" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Xóa bộ lọc
          </button>
        </div>
      </div>

      <div id="searchResults" style="margin-bottom: 15px; font-size: 14px; color: #666;"></div>

      <div id="productsTableContainer" style="max-height: 500px; overflow-y: auto; border: 1px solid #e8d7d7; border-radius: 4px; scrollbar-width: thin; scrollbar-color: #dc3545 #f1f1f1;">
        <table id="productsTable" style="width: 100%; margin: 0;">
          <thead style="position: sticky; top: 0; background: #dc3545; color: white; z-index: 10;">
            <tr>
              <th style="padding: 12px 8px; text-align: left;">ID</th>
              <th style="padding: 12px 8px; text-align: left;">Tên</th>
              <th style="padding: 12px 8px; text-align: right;">Giá</th>
              <th style="padding: 12px 8px; text-align: center;">Tồn</th>
              <th style="padding: 12px 8px; text-align: center;">Hành động</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      
      <style>
        #productsTableContainer::-webkit-scrollbar {
          width: 6px;
        }
        #productsTableContainer::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 3px;
        }
        #productsTableContainer::-webkit-scrollbar-thumb {
          background: #dc3545;
          border-radius: 3px;
        }
        #productsTableContainer::-webkit-scrollbar-thumb:hover {
          background: #c82333;
        }
        
        #productsTable tbody tr {
          transition: background-color 0.2s;
        }
        
        #productsTable tbody tr:hover {
          background-color: #f8f9fa;
        }
        
        #productsTable tbody tr:nth-child(even) {
          background-color: #f8f9fa;
        }
        
        #productsTable tbody tr:nth-child(even):hover {
          background-color: #e9ecef;
        }
        
        #productsTable tbody td {
          padding: 10px 8px;
          border-bottom: 1px solid #f0f0f0;
        }
      </style>
    </div>
  </div>
</body>
</html>


